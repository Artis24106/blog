<!DOCTYPE html>
<html
  dir="ltr"
  lang="en"
  data-theme="light"
><head>
  <title>
    artis24106
      |
      Reversing.kr - 2019 進度


    

  </title>

  
  <meta charset="utf-8" /><meta name="generator" content="Hugo 0.68.3" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta
    name="description"
    content="
      真白な夢 羽ばたかせよう


    "
  />
  
  
  
  <link
    rel="stylesheet"
    href="/blog/css/main.min.f08dfd6292604273495f670c5af67081690e166c26708b1dda2d9147b11b7fd9.css"
    integrity="sha256-8I39YpJgQnNJX2cMWvZwgWkOFmwmcIsd2i2RR7Ebf9k="
    crossorigin="anonymous"
    type="text/css"
  />
  
  
  <link
    rel="stylesheet"
    href="/blog/css/markupHighlight.min.cc84ed683057cc175ddfa738ea6ba2d5c882b95cb64f50bf9be918cb3791887b.css"
    integrity="sha256-zITtaDBXzBdd36c46mui1ciCuVy2T1C/m&#43;kYyzeRiHs="
    crossorigin="anonymous"
    type="text/css"
  />
  
    
    
    <link
      rel="stylesheet"
      href="/blog/css/custom.min.a1363d069c5c316cf7815c493173121e8e51fa70b375909ea796abf83a03c8b4.css"
      integrity="sha256-oTY9BpxcMWz3gVxJMXMSHo5R&#43;nCzdZCep5ar&#43;DoDyLQ="
      crossorigin="anonymous"
      media="screen"
    />

  
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
    crossorigin="anonymous"
  />
  
  <link rel="shortcut icon" href="/blogfavicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="180x180" href="/blogapple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/blogfavicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/blogfavicon-16x16.png" />

  <link rel="canonical" href="/blog/posts/reversing-kr/2019/" />

  
  
  
  
  <script
    type="text/javascript"
    src="/blog/js/anatole-header.min.413f798d8aa82610bef17a5ca1d7e962ec185be395f1aeb3f45d1891af568b65.js"
    integrity="sha256-QT95jYqoJhC&#43;8XpcodfpYuwYW&#43;OV8a6z9F0Yka9Wi2U="
    crossorigin="anonymous"
  ></script>

  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reversing.kr - 2019 進度"/>
<meta name="twitter:description" content="題目：Easy Crack, Ransomware"/>



  


  
  
  
  
  <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "articleSection": "posts",
        "name": "Reversing.kr - 2019 進度",
        "headline": "Reversing.kr - 2019 進度",
        "alternativeHeadline": "",
        "description": "
      
        \x3cp\x3e題目：\x3ccode\x3eEasy Crack\x3c\/code\x3e, \x3ccode\x3eRansomware\x3c\/code\x3e\x3c\/p\x3e


      


    ",
        "inLanguage": "en",
        "isFamilyFriendly": "true",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/artis24106.github.io\/blog\/posts\/reversing-kr\/2019\/"
        },
        "author" : {
            "@type": "Person",
            "name": "artis24106"
        },
        "creator" : {
            "@type": "Person",
            "name": "artis24106"
        },
        "accountablePerson" : {
            "@type": "Person",
            "name": "artis24106"
        },
        "copyrightHolder" : {
            "@type": "Person",
            "name": "artis24106"
        },
        "copyrightYear" : "2019",
        "dateCreated": "2019-08-18T12:38:25.00Z",
        "datePublished": "2019-08-18T12:38:25.00Z",
        "dateModified": "2019-08-18T12:38:25.00Z",
        "publisher":{
            "@type":"Organization",
            "name": "artis24106",
            "url": "https://artis24106.github.io/blog",
            "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/artis24106.github.io\/blogfavicon-32x32.png",
                "width":"32",
                "height":"32"
            }
        },
        "image": 
      [
      ]

    ,
        "url" : "https:\/\/artis24106.github.io\/blog\/posts\/reversing-kr\/2019\/",
        "wordCount" : "331",
        "genre" : [ 
      
      "CTF"

    ],
        "keywords" : [ 
      
      "CTF"

    
      
        ,

      
      "reversing.kr"

    
      
        ,

      
      "Reverse"

    ]
    }
  </script>



</head>
<body>
    <header><div
  class="page-top 
    .

  "
>
  <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
    <span aria-hidden="true"></span>
    <span aria-hidden="true"></span>
    <span aria-hidden="true"></span>
  </a>
  <nav>
    <ul class="nav__list" id="navMenu">
      <div class="nav__links">
        
        
          
          <li>
            <a
              
              href="/blog/posts/"
              
              title=""
              >Posts</a
            >
          </li>

        
          
          <li>
            <a
              
              href="/blog/tags/"
              
              title=""
              >Tags</a
            >
          </li>

        
          
          <li>
            <a
              
              href="/blog/categories/"
              
              title=""
              >Categories</a
            >
          </li>

        
        
      </div>
      <li>
        
      </li>
    </ul>
  </nav>
</div>
</header>
    <div class="wrapper">
      <aside><div
  class="sidebar
    .

  "
>
  <div class="sidebar__content">
    <div class="logo-title">
      <div class="title">
        <img src="https://avatars.githubusercontent.com/u/32833063?v=4" alt="profile picture" />
        <h3 title=""><a href="/blog">artis24106&#39;s blog</a></h3>
        <div class="description">
          <p>真白な夢 羽ばたかせよう</p>
        </div>
      </div>
    </div>
    <ul class="social-links">
      
        <li>
          <a href="https://github.com/Artis24106" rel="me" aria-label="Github">
            <i class="fab fa-github fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
    </ul>
  </div><footer class="footer footer--sidebar">
  <div class="by_farbox">
    <ul class="footer__list">
      <li class="footer__item">
        &copy;
        
          artis24106
          2021


        
      </li>
      
    </ul>
  </div>
</footer>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0K535799NY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());
  gtag('config', 'G-0K535799NY');
</script>
</div>
</aside>
      <main>
        <div class="autopagerize_page_element">
          <div class="content">
  <div
    class="post 
      .

    "
  >
    <div class="post-content">
      
      <div class="post-title">
        <h1>Reversing.kr - 2019 進度</h1>
        
      </div><p>題目：<code>Easy Crack</code>, <code>Ransomware</code></p>
<h2 id="easy-crack">Easy Crack</h2>
<h3 id="challenge-info">Challenge Info</h3>
<blockquote>
<p>只有 <code>Easy_CrackMe.exe</code> 一個檔案</p>
</blockquote>
<h3 id="solution">Solution</h3>
<p>使用 <code>file Easy_CrackMe.exe</code> 分析檔案</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">Easy_CrackMe.exe: PE32 executable (GUI) Intel 80386, for MS Windows
</code></pre></td></tr></table>
</div>
</div><p>實際執行看到有一個視窗可以輸入內容：</p>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/easy-crack1.png"   />
	
</figure></p>
<p>隨便輸入，得到警告訊息： Incorrect Password</p>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/easy-crack2.png"   />
	
</figure></p>
<p>看來目標應該跟 Password 有關</p>
<hr>
<p>用 IDA pro（32 位元）開啟 <code>Easy_CrackMe.exe</code></p>
<p>從 <code>WinMain(x,x,x,x)</code> 開始 trace code，它在最後 call <code>DialogFunc</code></p>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/easy-crack4_hu1acc7f651d1786b624b0b131c0db3307_95831_840x0_resize_box_2.png"   />
	
</figure></p>
<p>因此前往 <code>DialogueFunc</code>，看到它最後 call <code>sub_401080</code></p>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/easy-crack5.png"   />
	
</figure></p>
<p><code>sub_401080</code> 應該就是比較 Password 的 function</p>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/easy-crack6.png"   />
	
</figure></p>
<p>它在一開始宣告四個變數 <code>String</code>, <code>var_63</code>, <code>var_62</code>, <code>var_60</code> 儲存基本上連續的位置，然後在下面依序有四次比較：</p>
<p>第一個是 <code>61h</code> 對應到 <code>'a'</code></p>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/easy-crack7.png"   />
	
</figure></p>
<p>第二個是 <code>a5y</code> 對應到 <code>&quot;5y&quot;</code></p>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/easy-crack8.png"   />
	
</figure></p>
<p>第三個是 <code>aR3versing</code> 對應到 <code>&quot;R3versing&quot;</code></p>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/easy-crack9.png"   />
	
</figure></p>
<p>第四個是 <code>45h</code> 對應到 <code>'E'</code></p>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/easy-crack10.png"   />
	
</figure></p>
<p>因此根據位置排序，Password 應該是 &ldquo;E&rdquo; + &ldquo;a&rdquo; + &ldquo;5y&rdquo; + &ldquo;R3versing&rdquo; = <code>Ea5yR3versing</code></p>
<hr>
<p>實際輸入結果如下，看來沒有錯，而它也是 flag。</p>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/easy-crack3.png"   />
	
</figure></p>
<h3 id="flag">Flag</h3>
<p><code>Ea5yR3versing</code></p>
<hr>
<h2 id="ransomware">Ransomware</h2>
<h3 id="challenge-info-1">Challenge Info</h3>
<blockquote>
<p>有 <code>file</code>, <code>run.exe</code>, <code>readme.txt</code> 三個檔案</p>
</blockquote>
<h3 id="solution-1">Solution</h3>
<p><code>readme.txt</code> 內容如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">Decrypt File (EXE)


By Pyutic
</code></pre></td></tr></table>
</div>
</div><p>可能代表是要解密某個東西。</p>
<p>執行 <code>run.exe</code> 看看，前面有一段不知道在說什麼，後面要求輸入 key，輸入之後會再有一段亂碼。</p>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/ransomware3.png"   />
	
</figure></p>
<p>用 <code>file run.exe</code> 分析檔案：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">run.exe: PE32 executable (console) Intel 80386, for MS Windows, UPX compressed
</code></pre></td></tr></table>
</div>
</div><p>看來被 UPX 壓縮過，用 <code>upx -d run.exe</code> 解碼即可丟到 IDA 分析。</p>
<hr>
<p>是說前面有一大堆沒用的東西，讓 IDA 跑很久&hellip;</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">...
401009:       50      pushl   %eax
40100a:       58      popl    %eax
40100b:       53      pushl   %ebx
40100c:       5b      popl    %ebx
...（重複很多次）
</code></pre></td></tr></table>
</div>
</div><p>跳過之後看到程式會先將 <code>file</code> 讀出來（<code>rb</code>），之後會寫到 <code>byte_5415B8</code>。</p>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/ransomware4.png"   />
	
</figure></p>
<p>然後 loop <code>byte_5415B8</code> 的每個 byte，做一連串計算之後將結果寫回 <code>file</code> 裡面（<code>wb</code>）。</p>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/ransomware5_hua0487a579b41197080a26a8a73dd4af6_169731_840x0_resize_box_2.png"   />
	
</figure></p>
<p>上面提到的一連串計算是重點，它會將三個參數（藍色匡的部分）做 xor，它們分別是（假設 loop 到第 i 個 byte）：</p>
<ul>
<li><code>byte_5415B8[i]</code></li>
<li><code>key[i%len(key)]</code></li>
<li><code>0xFF</code></li>
</ul>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/ransomware6.png"   />
	
</figure></p>
<p>剛才觀察到的整個流程大致如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./file&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
	<span class="n">f_data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">enc</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f_data</span><span class="p">)):</span>
	<span class="n">enc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">^</span> <span class="mh">0xFF</span><span class="p">)</span>
<span class="n">enc</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./file&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
	<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>也就是說 <code>run.exe</code> 的作用是讀取 key 然後更改 <code>file</code>。</p>
<hr>
<p>這個時候 <code>readme.txt</code> 便派上用場，它似乎暗示 <code>file</code> 應該要是個 <code>EXE</code> 檔，如果是這樣，代表只要找到更改它的 key 就能反推回原本的 <code>file</code>。</p>
<p>因為 <code>file</code> 要是 <code>EXE</code> 檔，其前 116 位為固定值（ <code>DOS Header</code> 跟 <code>DOS STUB</code> ），只要 key 的長度不大於 116，便可以逆推，腳本如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./file&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f_file</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./run.exe&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f_header</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">116</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">f_file</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">f_header</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="mh">0xff</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
<span class="k">print</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>執行結果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">letsplaychessletsplaychessletsplaychessletsplaychessletsplaychessletsplaychessletsplaychessletsplaychessletsplayches
</code></pre></td></tr></table>
</div>
</div><p>十分順利，<code>key</code> 每 13 位會重複，因此 key 為 <code>&quot;letsplaychess&quot;</code> 或其倍數（ <code>&quot;letsplaychessletsplaychess&quot;</code> 之類的）</p>
<blockquote>
<p>一開始測試時在 <code>run.exe</code> 隨便輸入了 <code>key</code> 導致 <code>file</code> 已經被改掉了，因此執行腳本前要重新解壓一份新的 <code>file</code></p>
</blockquote>
<hr>
<p>執行 <code>run.exe</code> 輸入 <code>&quot;letsplaychess&quot;</code>，得到 <code>file.exe</code> 並且執行，然後跑出小錯誤 QQ</p>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/ransomware1.png"   />
	
</figure></p>
<p>修復之後得到 <code>Key -&gt; Colle System</code></p>
<p>

<figure>
	<img src="/blog/posts/reversing-kr/2019/img/ransomware2.png"   />
	
</figure></p>
<h3 id="flag-1">Flag</h3>
<p><code>Colle System</code></p></div>
    <div class="post-footer">
      <div class="info">
        
          <span class="separator"><a class="category" href="/blog/categories/ctf/">CTF</a></span>




        

        
          <span class="separator"><a class="tag" href="/blog/tags/ctf/">CTF</a><a class="tag" href="/blog/tags/reversing%2ekr/">reversing.kr</a><a class="tag" href="/blog/tags/reverse/">Reverse</a></span>




        
      </div>
    </div>

    
  </div>


          </div>
        </div>
      </main>
    </div><footer class="footer footer--base">
  <div class="by_farbox">
    <ul class="footer__list">
      <li class="footer__item">
        &copy;
        
          artis24106
          2021


        
      </li>
      
    </ul>
  </div>
</footer>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0K535799NY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());
  gtag('config', 'G-0K535799NY');
</script>
</body>
</html>
